# Pre-commit hooks configuration
# Install pre-commit: pip install pre-commit
# Install hooks: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
        exclude: 'tsconfig.*\.json$'  # Exclude TypeScript config files (they support comments)
      - id: check-toml
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: mixed-line-ending
      - id: detect-private-key

  # Python code formatting with black (optional)
  # - repo: https://github.com/psf/black
  #   rev: 24.10.0
  #   hooks:
  #     - id: black
  #       language_version: python3.11

  # Python linting with flake8
  - repo: https://github.com/PyCQA/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        args: ['--max-line-length=150', '--extend-ignore=E203,W503']
        files: ^plotsense/

  # Python import sorting (optional)
  # - repo: https://github.com/PyCQA/isort
  #   rev: 5.13.2
  #   hooks:
  #     - id: isort
  #       args: ['--profile', 'black']

  # Python type checking with mypy (optional - requires type stubs)
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.13.0
  #   hooks:
  #     - id: mypy
  #       additional_dependencies: [types-requests]
  #       files: ^plotsense/

  # Python security check
  - repo: https://github.com/PyCQA/bandit
    rev: 1.8.0
    hooks:
      - id: bandit
        args: ['-c', 'pyproject.toml']
        additional_dependencies: ['bandit[toml]']
        files: ^plotsense/

  # Python tests (fast unit tests only) - Optional
  # Uncomment to run tests before each commit (can be slow)
  # - repo: local
  #   hooks:
  #     - id: pytest-check
  #       name: pytest (quick unit tests)
  #       entry: pytest
  #       language: system
  #       pass_filenames: false
  #       args: ['-v', '--tb=short', '-x', '--maxfail=3', 'test/', '-m', 'not slow']
  #       always_run: false
  #       files: ^(plotsense/|test/).*\.py$

  # Frontend linting (ESLint) - Optional
  # Uncomment if you want to run ESLint before commits
  # - repo: local
  #   hooks:
  #     - id: eslint
  #       name: ESLint
  #       entry: bash -c 'cd web && npm run lint'
  #       language: system
  #       files: ^web/.*\.(ts|tsx|js|jsx)$
  #       pass_filenames: false

  # Frontend type checking - Optional
  # Uncomment if you want to run TypeScript checking before commits
  # - repo: local
  #   hooks:
  #     - id: tsc
  #       name: TypeScript Compiler
  #       entry: bash -c 'cd web && npx tsc --noEmit'
  #       language: system
  #       files: ^web/.*\.(ts|tsx)$
  #       pass_filenames: false

  # Commit message linting (conventional commits) - Optional
  # Uncomment if you want to enforce conventional commit messages
  # - repo: https://github.com/alessandrojcm/commitlint-pre-commit-hook
  #   rev: v9.5.0
  #   hooks:
  #     - id: commitlint
  #       stages: [commit-msg]
  #       additional_dependencies: ['@commitlint/config-conventional']

# Global exclusions
exclude: |
  (?x)(
      ^venv/|
      ^env/|
      ^\.venv/|
      ^node_modules/|
      ^web/node_modules/|
      ^web/dist/|
      ^htmlcov/|
      ^\.pytest_cache/|
      ^\.coverage$|
      ^coverage\.xml$|
      \.min\.js$|
      \.min\.css$
  )
